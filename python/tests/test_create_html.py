from output.create_html import build_html_table, convert_to_rows_array, convert_rows_array_to_html
from interface.search_issues import get_linked_issues_for_epiclist
from driver_data.response import response
simple_object = {'issue_id': '10022', 'issue_key': 'MPPSAM-23', 'issue_type': 'Story', 'timespent': None, 'project': 'mpp-sample', 'priority': 'Medium', 'assignee_name': 'rick', 'status_name': 'Done', 'created': '2023-06-03T06:19:25.000+0000', 'resolution_date': '2023-06-15T14:54:25.000+0000', 'development': '{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@337f5620[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@39fcfe05[overall=PullRequestOverallBean{stateCount=0, state=\'OPEN\', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@11031f1f[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@4f51c7ec[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@621b7ee3[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@1e80c19d[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@1772ceb5[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@56dd1510[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@6f08954e[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@771c3d1b[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@761a422b[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@48d1bc6d[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={"cachedValue":{"errors":[],"configErrors":[],"summary":{"pullrequest":{"overall":{"count":0,"lastUpdated":null,"stateCount":0,"state":"OPEN","details":{"openCount":0,"mergedCount":0,"declinedCount":0,"total":0},"open":true},"byInstanceType":{}},"build":{"overall":{"count":0,"lastUpdated":null,"failedBuildCount":0,"successfulBuildCount":0,"unknownBuildCount":0},"byInstanceType":{}},"review":{"overall":{"count":0,"lastUpdated":null,"stateCount":0,"state":null,"dueDate":null,"overDue":false,"completed":false},"byInstanceType":{}},"deployment-environment":{"overall":{"count":0,"lastUpdated":null,"topEnvironments":[],"showProjects":false,"successfulCount":0},"byInstanceType":{}},"repository":{"overall":{"count":0,"lastUpdated":null},"byInstanceType":{}},"branch":{"overall":{"count":0,"lastUpdated":null},"byInstanceType":{}}}},"isStale":false}}', 'story_points': 2.0}
custom_fields = [{'id': 'customfield_10000', 'name': 'Development'},{'id': 'customfield_10106', 'name': 'Epic Colour'},{'id': 'customfield_10109', 'name': 'Epic Link'},{'id': 'customfield_10104', 'name': 'Epic Name'},{'id': 'customfield_10105', 'name': 'Epic Status'},{'id': 'customfield_10103', 'name': 'Original story points'},{'id': 'customfield_10100', 'name': 'Parent Link'},{'id': 'customfield_10108', 'name': 'Rank'},{'id': 'customfield_10110', 'name': 'Sprint'},{'id': 'customfield_10111', 'name': 'Story Points'},{'id': 'customfield_10102', 'name': 'Target end'},{'id': 'customfield_10101', 'name': 'Target start'},{'id': 'customfield_10107', 'name': 'Team'}]
default_fields = ['Development','Epic Colour','Epic Link','Epic Name','Epic Status','Original story points','Parent Link','Rank','Sprint','Story Points','Target end','Target start','Team']
renamed_fields = ['development','epic_color','epic_link','epic_name','epic_status','original_story_points','parent_link','rank','sprint','story_points','target_end','target_start','team']
renamed_fields_for_row = ['issue_id', 'issue_key', 'issue_type', 'timespent', 'project', 'priority', 'assignee_name', 'status_name', 'created', 'resolution_date', 'story_points']

expected_headings_array = ['Issue ID','Issue Key','Issue Type','Time Spent','Project','Priority','Assignee Name','Status Name','Created','Resolution Date','Development','Story Points']
expected_row = ['10022', 'MPPSAM-23', 'Story', None, 'mpp-sample', 'Medium', 'rick', 'Done', '2023-06-03T06:19:25.000+0000', '2023-06-15T14:54:25.000+0000', 2.0]

expected_output_array = [
    ['10022', 'MPPSAM-23', 'Story', None, 'mpp-sample', 'Medium', 'rsegrest77@gmail.com', 'Done', '2023-06-03T06:19:25.000+0000', '2023-06-15T14:54:25.000+0000', 2.0],
    ['10021', 'MPPSAM-22', 'Story', None, 'mpp-sample', 'Medium', 'rsegrest77@gmail.com', 'Done', '2023-06-03T06:19:25.000+0000', '2023-06-13T13:16:25.000+0000', 2.0],
    ['10020', 'MPPSAM-21', 'Story', None, 'mpp-sample', 'Medium', 'rsegrest77@gmail.com', 'Done', '2023-06-03T06:19:25.000+0000', '2023-06-10T21:56:25.000+0000', 1.0],
    ['10019','MPPSAM-20','Story',None,'mpp-sample','Medium','rsegrest77@gmail.com','Done','2023-06-03T06:19:25.000+0000','2023-06-08T15:18:25.000+0000',3.0],
    ['10018','MPPSAM-19','Story',None,'mpp-sample','Medium','rsegrest77@gmail.com','Done','2023-06-03T06:19:25.000+0000','2023-06-07T02:43:25.000+0000',5.0],
    ['10017','MPPSAM-18','Story',None,'mpp-sample','Medium','rsegrest77@gmail.com','Done','2023-06-03T06:19:25.000+0000','2023-06-04T02:49:25.000+0000',3.0],
    ['10015','MPPSAM-16','Story',None,'mpp-sample','Medium',None,'Done','2023-05-27T11:25:25.000+0000','2023-06-18T14:01:25.000+0000',2.0],
    ['10014','MPPSAM-15','Story',None,'mpp-sample','Medium',None,'Done','2023-06-17T07:29:25.000+0000','2023-06-21T22:05:25.000+0000',4.0],
    ['10013','MPPSAM-14','Story',None,'mpp-sample','Medium','rsegrest77@gmail.com','To Do','2023-06-23T12:29:25.000+0000',None,3.0],
    ['10009','MPPSAM-10','Story',None,'mpp-sample','Medium','rsegrest77@gmail.com','In Progress','2023-06-17T07:29:25.000+0000',None,5.0],
    ['10008','MPPSAM-9','Story',None, 'mpp-sample', 'Medium', None, 'To Do', '2023-06-24T16:39:30.000+0000', None, 3.0],
    ['10005', 'MPPSAM-6', 'Story', None, 'mpp-sample', 'Medium', None, 'To Do', '2023-06-24T16:39:29.000+0000', None, 1.0],
    ['10004', 'MPPSAM-5', 'Story', None, 'mpp-sample', 'Medium', None, 'To Do', '2023-06-24T16:39:29.000+0000', None, 1.0],
    ['10003', 'MPPSAM-4', 'Story', None, 'mpp-sample', 'Medium', None, 'To Do', '2023-06-24T16:39:29.000+0000', None, 5.0],
    ['10002', 'MPPSAM-3', 'Story', None, 'mpp-sample', 'Medium', None, 'To Do', '2023-06-24T16:39:29.000+0000', None, 5.0],
    ['10001', 'MPPSAM-2', 'Story', None, 'mpp-sample', 'Medium', None, 'To Do', '2023-06-24T16:39:28.000+0000', None, 2.0],
    ['10000', 'MPPSAM-1', 'Story', None, 'mpp-sample', 'Medium', None, 'To Do', '2023-06-24T16:39:25.000+0000', None, 2.0]
]
expected_html_string = '<table><thead><tr><th>Issue ID</th><th>Issue Key</th><th>Issue Type</th><th>Time Spent</th><th>Project</th><th>Priority</th><th>Assignee Name</th><th>Status Name</th><th>Created</th><th>Resolution Date</th><th>Story Points</th></tr></thead><tbody>'
expected_html_table_body_string = '<tbody><tr><td>10022</td><td>MPPSAM-23</td><td>Story</td><td>None</td><td>mpp-sample</td><td>Medium</td><td>rsegrest77@gmail.com</td><td>Done</td><td>2023-06-03T06:19:25.000+0000</td><td>2023-06-15T14:54:25.000+0000</td><td>2.0</td></tr><tr><td>10021</td><td>MPPSAM-22</td><td>Story</td><td>None</td><td>mpp-sample</td><td>Medium</td><td>rsegrest77@gmail.com</td><td>Done</td><td>2023-06-03T06:19:25.000+0000</td><td>2023-06-13T13:16:25.000+0000</td><td>2.0</td></tr></tbody>'

expected_html_table = '<table><thead><tr><th>Issue ID</th><th>Issue Key</th><th>Issue Type</th><th>Time Spent</th><th>Project</th><th>Priority</th><th>Assignee Name</th><th>Status Name</th><th>Created</th><th>Resolution Date</th><th>Story Points</th><tbody><tr><td>10022</td><td>MPPSAM-23</td><td>Story</td><td>None</td><td>mpp-sample</td><td>Medium</td><td>rsegrest77@gmail.com</td><td>Done</td><td>2023-06-03T06:19:25.000+0000</td><td>2023-06-15T14:54:25.000+0000</td><td>2.0</td></tr><tr><td>10021</td><td>MPPSAM-22</td><td>Story</td><td>None</td><td>mpp-sample</td><td>Medium</td><td>rsegrest77@gmail.com</td><td>Done</td><td>2023-06-03T06:19:25.000+0000</td><td>2023-06-13T13:16:25.000+0000</td><td>2.0</td></tr><tr><td>10020</td><td>MPPSAM-21</td><td>Story</td><td>None</td><td>mpp-sample</td><td>Medium</td><td>rsegrest77@gmail.com</td><td>Done</td><td>2023-06-03T06:19:25.000+0000</td><td>2023-06-10T21:56:25.000+0000</td><td>1.0</td></tr><tr><td>10019</td><td>MPPSAM-20</td><td>Story</td><td>None</td><td>mpp-sample</td><td>Medium</td><td>rsegrest77@gmail.com</td><td>Done</td><td>2023-06-03T06:19:25.000+0000</td><td>2023-06-08T15:18:25.000+0000</td><td>3.0</td></tr><tr><td>10018</td><td>MPPSAM-19</td><td>Story</td><td>None</td><td>mpp-sample</td><td>Medium</td><td>rsegrest77@gmail.com</td><td>Done</td><td>2023-06-03T06:19:25.000+0000</td><td>2023-06-07T02:43:25.000+0000</td><td>5.0</td></tr><tr><td>10017</td><td>MPPSAM-18</td><td>Story</td><td>None</td><td>mpp-sample</td><td>Medium</td><td>rsegrest77@gmail.com</td><td>Done</td><td>2023-06-03T06:19:25.000+0000</td><td>2023-06-04T02:49:25.000+0000</td><td>3.0</td></tr><tr><td>10015</td><td>MPPSAM-16</td><td>Story</td><td>None</td><td>mpp-sample</td><td>Medium</td><td>None</td><td>Done</td><td>2023-05-27T11:25:25.000+0000</td><td>2023-06-18T14:01:25.000+0000</td><td>2.0</td></tr><tr><td>10014</td><td>MPPSAM-15</td><td>Story</td><td>None</td><td>mpp-sample</td><td>Medium</td><td>None</td><td>Done</td><td>2023-06-17T07:29:25.000+0000</td><td>2023-06-21T22:05:25.000+0000</td><td>4.0</td></tr><tr><td>10013</td><td>MPPSAM-14</td><td>Story</td><td>None</td><td>mpp-sample</td><td>Medium</td><td>rsegrest77@gmail.com</td><td>To Do</td><td>2023-06-23T12:29:25.000+0000</td><td>None</td><td>3.0</td></tr><tr><td>10009</td><td>MPPSAM-10</td><td>Story</td><td>None</td><td>mpp-sample</td><td>Medium</td><td>rsegrest77@gmail.com</td><td>In Progress</td><td>2023-06-17T07:29:25.000+0000</td><td>None</td><td>5.0</td></tr><tr><td>10008</td><td>MPPSAM-9</td><td>Story</td><td>None</td><td>mpp-sample</td><td>Medium</td><td>None</td><td>To Do</td><td>2023-06-24T16:39:30.000+0000</td><td>None</td><td>3.0</td></tr><tr><td>10005</td><td>MPPSAM-6</td><td>Story</td><td>None</td><td>mpp-sample</td><td>Medium</td><td>None</td><td>To Do</td><td>2023-06-24T16:39:29.000+0000</td><td>None</td><td>1.0</td></tr><tr><td>10004</td><td>MPPSAM-5</td><td>Story</td><td>None</td><td>mpp-sample</td><td>Medium</td><td>None</td><td>To Do</td><td>2023-06-24T16:39:29.000+0000</td><td>None</td><td>1.0</td></tr><tr><td>10003</td><td>MPPSAM-4</td><td>Story</td><td>None</td><td>mpp-sample</td><td>Medium</td><td>None</td><td>To Do</td><td>2023-06-24T16:39:29.000+0000</td><td>None</td><td>5.0</td></tr><tr><td>10002</td><td>MPPSAM-3</td><td>Story</td><td>None</td><td>mpp-sample</td><td>Medium</td><td>None</td><td>To Do</td><td>2023-06-24T16:39:29.000+0000</td><td>None</td><td>5.0</td></tr><tr><td>10001</td><td>MPPSAM-2</td><td>Story</td><td>None</td><td>mpp-sample</td><td>Medium</td><td>None</td><td>To Do</td><td>2023-06-24T16:39:28.000+0000</td><td>None</td><td>2.0</td></tr><tr><td>10000</td><td>MPPSAM-1</td><td>Story</td><td>None</td><td>mpp-sample</td><td>Medium</td><td>None</td><td>To Do</td><td>2023-06-24T16:39:25.000+0000</td><td>None</td><td>2.0</td></tr></tbody></tr></thead><tbody>'


def test_convert_rows():
    response = get_linked_issues_for_epiclist()
    issues = response['issues']
    output_array = convert_to_rows_array(issues)
    output_html_values = convert_rows_array_to_html([output_array[0], output_array[1]])
    assert output_array == expected_output_array
    assert output_html_values == expected_html_table_body_string

def test_build_html_table():
    html_result = build_html_table()
    assert html_result == expected_html_table

# def test_get_headings_array():
#     assert convert_to_row_array(simple_object, renamed_fields_for_row) == expected_row
